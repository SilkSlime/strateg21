<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Анализ стратегии</title>
    <link rel="icon" type="image/png" href="assets/images/favicon.png" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/bootstrap-select.css" />
    <link rel="stylesheet" href="css/tree.css" />

    <link rel="stylesheet" href="css/style.css" />
    <style></style>
</head>

<body>
    <nav class="navbar navbar-light bg-light navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="">
                <img src="assets/images/bmstu.png" alt="" width="30" height="28"
                    class="d-inline-block align-text-top" />
                Strateg-21
            </a>
            <div class="navbar-collapse">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="analys.html">Анализ стратегии</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="search.html">Поиск стратегии</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="card_settings.html">Настройка полей карточек</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="settings.html">Настройка программы</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container mt-5 mb-5">
        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h5 class="ml-auto">
                            Параметры поиска
                        </h5>
                        <div class="mb-3">
                            <label class="form-label">Поиск по названию стратегии:</label>
                            <input type="text" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Поиск по странам:</label>
                            <select class="form-control selectpicker" multiple data-live-search="true" id="countries-picker">
                                
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Поиск по темам:</label>
                            <div id="jstree1"></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Поиск по политичесским инструментам</label>
                            <div id="jstree2"></div>
                        </div>
                        <div class="mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Фильтрация по дате создания</label>
                            <div class="row">
                                <div class="col flex-center">
                                    <div class="mb-3">
                                        <label class="form-label">Начальная дата:</label>
                                        <input type="date" class="form-control" id="start-date">
                                        <span class="text-muted small clear" data-id="startDate">Очистить</span>
                                    </div>
                                </div>
                                <div class="col flex-center">
                                    <div class="mb-3">
                                        <label class="form-label">Конечная дата:</label>
                                        <input type="date" class="form-control" id="end-date">
                                        <span class="text-muted small clear" data-id="endDate">Очистить</span>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="exampleFormControlInput1" class="form-label">Фильтрация по году разработки
                                    стратегии</label>
                                <div class="row">
                                    <div class="col flex-center">
                                        <div class="mb-3">
                                            <label class="form-label">Начальный год:</label>
                                            <input type="number" class="form-control" id="start-year">
                                        </div>
                                    </div>
                                    <div class="col flex-center">
                                        <div class="mb-3">
                                            <label class="form-label">Конечный год:</label>
                                            <input type="number" class="form-control" id="end-year">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-grid">
                                <button id="search" class="btn btn-outline-primary" type="button">Выполнить поиск</button>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-8">
                        <h5 class="ml-auto">
                            Стартегии, отобранные по заданным критериям:
                        </h5>
                        <table class="table table-sm table-striped table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Дата создания</th>
                                    <th scope="col">Имя файла</th>
                                    <th scope="col">Название стратегии</th>
                                    <th scope="col">Страна</th>
                                    <th scope="col">Год</th>
                                </tr>
                            </thead>
                            <tbody id="result-table-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.bundle.min.js"></script>
        <script src="js/bootstrap-select.min.js"></script>
        <script src="js/tree.js"></script>
        <script>
            //////////////// VALUES //////////////
            let searchData = {
                countries: [],
                themes: [],
                politicalInstruments: [],
                startDate: undefined,
                endDate: undefined,
                startYear: undefined,
                endDate: undefined
            }
            let  = [];
            let selectedThemes = [];
            let selectedPoliticalInstruments = [];
            let startDate = undefined;
            let endDate = undefined;
            let startYear = undefined;
            let endYear = undefined;

            //////////////// COUNTRIES PICKER //////////////
            // TODO Get countries list
            let countries = [
                'Russia',
                "USA",
                "USSR",
                "France"
            ]
            //
            let countriesPicker = document.querySelector("#countries-picker");
            for (let country of countries) {
                countriesPicker.innerHTML+=`<option value="${country}">${country}</option>\n`;
            }
            $(countriesPicker).selectpicker();
            countriesPicker.addEventListener("change", function(e) {
                searchData.countries = [];
                for (let option of countriesPicker.selectedOptions) {
                    searchData.countries.push(option.value);
                }
            });
            ////////////////////////////////////////////////

            //////////////// TREE SELECT //////////////
            //TODO Get tree data
            let tree_data1 = [
                {
                    text: "Тематический классификатор",
                    children: [],
                },
            ];

            let tree_data2 = [
                {
                    text: "Классификатор политических инструментов",
                    children: [
                        {
                            text: "Governance",
                            children: [],
                        },
                        {
                            text: "Financial support",
                            children: [],
                        },

                        {
                            text: "Enablers and other incentives ",
                            children: [],
                        },
                        {
                            text: "Guidance and regulation ",
                            children: [
                                {
                                    text: "Regulatory oversight and ethical advice bodies",
                                    children: [],
                                },
                                {
                                    text: "Labour mobility regulation and incentives",
                                    children: [],
                                },
                                {
                                    text: "Standards for technology development",
                                    children: [],
                                },
                            ],
                        },
                    ],
                },
            ];
            //

            let themes = new Tree("jstree1", tree_data1);
            let politicalInstruments = new Tree("jstree2", tree_data2);

            for (let chbox of themes.tree.querySelectorAll(".tree-check")) {
                chbox.addEventListener("change", function() {
                    searchData.themes = themes.getValues();
                });
            }

            for (let chbox of politicalInstruments.tree.querySelectorAll(".tree-check")) {
                chbox.addEventListener("change", function() {
                    searchData.politicalInstruments = politicalInstruments.getValues();
                });
            }
            ////////////////////////////////////////////////

            //////////////// DATE / YEAR SELECT //////////////
            document.querySelector("#start-date").addEventListener("input", function(e) {
                console.log(111);
                searchData.startDate = e.currentTarget.value;
            });
            document.querySelector("#end-date").addEventListener("input", function(e) {
                searchData.endDate = e.currentTarget.value;
            });

            for (let element of document.querySelectorAll(".clear")) {
                element.addEventListener("click", function (e) {
                    e.currentTarget.previousElementSibling.value = "";
                    searchData[e.currentTarget.dataset.id] = undefined;
                });
            }


            document.querySelector("#start-year").addEventListener("input", function(e) {
                searchData.startYear = e.currentTarget.value;
            });
            document.querySelector("#end-year").addEventListener("input", function(e) {
                searchData.endYear = e.currentTarget.value;
            });
            ////////////////////////////////////////////////

            ///////////// SEARCH BUTTON & GET DATA /////////////

            document.querySelector("#search").addEventListener("click", function(e) {
                // TODO Get table data
                let tableData = [
                {
                        creationDate: "fsdfsd",
                        filename: "dafsdf",
                        strategyName: "fsdfsfd",
                        country: "dfsdf",
                        year: "fsdfsdf"
                    },
                    {
                        creationDate: "fsdfsd",
                        filename: "dafsdf",
                        strategyName: "fsdfsfd",
                        country: "dfsdf",
                        year: "fsdfsdf"
                    },
                    {
                        creationDate: "fsdfsd",
                        filename: "dafsdf",
                        strategyName: "fsdfsfd",
                        country: "dfsdf",
                        year: "fsdfsdf"
                    }
                ]
                //
                let tableBody = document.querySelector("#result-table-body");
                tableBody.innerHTML = "";
                for (let row of tableData) {
                    tableBody.innerHTML+=`<tr><td>${row.creationDate}</td><td>${row.filename}</td><td>${row.strategyName}</td><td>${row.country}</td><td>${row.year}</td></tr>`;
                }
            });

            //////////////////////////////////////////////////////
        </script>
</body>

</html>